---
title: "RespondingToMatthew'sIssues"
output: html_document
---

```{r setup, include=FALSE}
library('knitr')
knitr::opts_chunk$set(cache=TRUE)
knitr::opts_chunk$set(eval=FALSE)
opts_chunk$set(fig.path = "/Users/sarahurbut/Dropbox/PaperEdits/Paper/Figures/") 
```

Let's make a heatmap of lfsr and lfdr:

```{r,eval=T,echo=FALSE}
source("~/gtexresults_matrixash/Analysis/normfuncs.R")
lfsr=read.table("~/Dropbox/Aug12/Aug13withEDlfsr.txt")[,-1]

lfsr[lfsr<0]=0
nsig=lfsr<0.05
sig=rowSums(nsig)

lfdr=read.table("~/Dropbox/withzero/withzeroposterior.nulls.txt")[,-1]
standardized.effects=read.table("~/Dropbox/Aug12/Aug13withEDposterior.means.txt")[,-1]
pm.mash.beta=read.table("~/gtexresults_matrixash/Data/Aug13withEDposterior.betas.txt")
tissue.names=as.character(read.table("~/gtexresults_matrixash/Data/abbreviate.names.txt")[,2])

colnames(lfsr)=colnames(lfdr)=colnames(standardized.effects)=colnames(pm.mash.beta)=tissue.names

```

First, we plot with no sort because we want to compare lfsr and lfdr to show the importance of considering the effect size:

```{r, echo=FALSE}

library('gplots')
png("~/Dropbox/PaperEdits/Paper/Figures/lfsrnosort.png")
heatmap.2((as.matrix(lfsr)),main="LFSR, Unsorted",dendrogram="none",density="none",Colv=FALSE,Rowv=FALSE,trace="none",col=bluered(1000),cexRow=0.5,cexCol=0.5,labRow = "",ylab = "Gene",xlab="",key = T)
dev.off()

library('gplots')
png("~/Dropbox/PaperEdits/Paper/Figures/lfdnosort.png")
heatmap.2((as.matrix(lfdr)),main="LFDR, Unsorted",dendrogram="none",density="none",Colv=FALSE,Rowv = FALSE,trace="none",col=bluered(1000),cexRow=0.5,cexCol=0.5,labRow = "",ylab = "Gene",xlab="",key = FALSE)
dev.off()




```

![/users/sarahurbut/Dropbox/PaperEdits/Paper/Figures/lfdrsort.png](/Users/sarahurbut/Dropbox/PaperEdits/Paper/Figures/lfdrsort.png).
![/users/sarahurbut/Dropbox/PaperEdits/Paper/Figures/lfsrsort.png](/Users/sarahurbut/Dropbox/PaperEdits/Paper/Figures/lfsrsort.png).

Now, we plot the sorted lfsr to detect interesting patterns:

```{r, echo=FALSE,eval=FALSE} 

lfsr.true=lfsr[sig>0,]
lfdr.true=lfdr[sig>0,]
library('gplots')
lfsr.cols <- colorRampPalette(c("darkgreen", "yellow", "red"))(256)
lfsr.cols <- colorRampPalette(c("yellow", "red"))(256)
png("~/Dropbox/PaperEdits/Paper/Figures/lfsrsort.png")
#First get sorted indices
y=heatmap.2(as.matrix(lfsr.true),main="LFSR,Sorted",dendrogram="none",density="none",Colv=FALSE,#Rowv=FALSE,
            #col=rich.colors(1000),
            #col=greenred,
            col=lfsr.cols,
trace="none",
#col=bluered(1000),
 cexRow=0.5,cexCol=0.5,labRow = "",ylab = "Gene",xlab="",key=TRUE)

# heatmap.2(as.matrix(lfsr.true[rev(y$rowInd),]),main="LFSR,Sorted",dendrogram="none",density="none",Colv=FALSE,Rowv=FALSE,
#           trace="none",col=greenred,cexRow=0.5,cexCol=0.5,labRow = "",ylab = "Gene",xlab="",breaks=seq(0,1,by=0.01),key=TRUE)
dev.off()

lfdr.shuffle=as.matrix(lfdr.true[rev(y$rowInd),])


png("~/Dropbox/PaperEdits/Paper/Figures/lfdrsort.png")
heatmap.2((lfdr.shuffle),main="LFDR,Sorted",dendrogram="none",density="none",Colv=FALSE,Rowv=FALSE,trace="none",col=lfsr.cols,cexRow=0.5,cexCol=0.5,labRow = "",ylab = "Gene",xlab="",breaks=seq(0,1,by=1/256),key=TRUE)
dev.off()




```

 Let's try a heatmap of estimated effect size, restricting our consideration to those that are significant in at least one tissue.
 
```{r, echo=FALSE,eval=FALSE} 

library('gplots')
library('colorRamps')

png("~/Dropbox/PaperEdits/Paper/Figures/postbetas.png")
#heatmap.2(het.norm(pm.mash.beta)[rev(y$rowInd),],main="E(Bj|data)",dendrogram="none",density="none",Colv=FALSE,Rowv=FALSE,
#trace="none",col=redgreen,cexRow=0.5,cexCol=0.5,labRow = "",ylab = "Gene",xlab="",key=TRUE)


# color.gradient <- function(x, colors=c("red","yellow","green"), colsteps=100) {
#     return( colorRampPalette(colors) (colsteps) [ findInterval(x, seq(min(x),max(x), length.out=colsteps)) ] )
# }

cols <- colorRampPalette(c("magenta", "yellow", "darkgreen"))(256)
# cols
#plot(c(1:256), c(1:256), pch = 16, col = cols, cex = 3)

heatmap.2(het.norm(pm.mash.beta[sig>0,]),main="E(Bjnorm|data)",dendrogram="none",density="none",Colv=FALSE,#Rowv=FALSE,
          trace="none",
          #col=redgreen,
            col=redblue(256),
            #col=rich.colors(1000),
          #col=magenta2green,
          #col=cols,
            #col=color.gradient(het.norm(pm.mash.beta)),
            #col=brewer.pal(1000, "Spectral"),
          cexRow=0.5,cexCol=0.5,labRow = "",ylab = "Gene",xlab="",key=TRUE)
dev.off()
```
 
![/users/sarahurbut/Dropbox/PaperEdits/Paper/Figures/postbetas.png](/Users/sarahurbut/Dropbox/PaperEdits/Paper/Figures/postbetas.png).

