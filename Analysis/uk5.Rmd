---
title: "Examples of Uk5"
output: html_document
---
 
In this document, I will look at all the examples who have maximal loading on Uk4 and Uk5. Recall their eigenvector and proportion of hierarchical weight:


```{r loaddata,echo=FALSE}
covmat=readRDS("../Data/covmatAug13withED.rds")
pis=readRDS("../Data/pisAug13withED.rds")$pihat
z.stat=read.table("../Data/maxz.txt")
pi.mat=matrix(pis,ncol=54,byrow=T)
lfsr=read.table("../Data/Aug13withEDlfsr.txt")[,-1]
#post.weights=read.table("~/Dropbox/Aug12/Aug13withEDpost.weights.txt")[,-1]
posterior.means=read.table("../Data/Aug13withEDposterior.means.txt")[,-1]
colnames(posterior.means)=colnames(lfsr)=colnames(z.stat)


abr.names=as.character(read.table("../Data/abbreviate.names.txt")[,2])
newfunc=function(t){
  par(mfrow=c(1,2))
  name=strsplit(rownames(z.stat)[t], "[.]")[[1]][1]
  x.min=min(as.numeric(z.stat[t,]),as.numeric(posterior.means[t,]))
  x.max=max(as.numeric(z.stat[t,]),as.numeric(posterior.means[t,]))
a=barplot(as.numeric(z.stat[t,]),xlab="",las=2,cex.names=0.5,names=colnames(z.stat),
ylim=c(x.min,x.max))
title(main=paste0("Z Statistic"),font.main=1,col.main="blue")
mtext(paste0(name),col="purple")
b=barplot(as.numeric(posterior.means[t,]),col=col.func(t,lfsr=lfsr,posterior.means=posterior.means),xlab="",cex.names=0.5,las=2,ylab="E(B|Data)/s.j",ylim=c(x.min,x.max),names=colnames(posterior.means))
title(main=paste0("E(B|Data)/s.j"),font.main=1,col.main="blue")
mtext(paste0(name),col="purple")
}

col.func=function(lfsr,posterior.means,j){
  R=ncol(posterior.means)
  lfsr.mat=as.matrix(lfsr)
  col.mat=NULL
  for(r in 1:R){
 if (lfsr.mat[j,r]<=0.05) {
      col.mat[r]="green"
    } else if (lfsr.mat[j,r]<0.5) {
      col.mat[r]="orange"
    } else if (lfsr.mat[j,r]>=0.50) {
      col.mat[r]="red"
    } 
  }
  return(col.mat)
}


library(gplots)
library(ggplot2)

cols=read.table("../Data/maxColsums.txt")[,1]
rows=read.table("../Data/maxrowsums.txt")[,1]
```


I generated a list of associations who have maximal posterior weight at each component:



```{r eval=FALSE, echo=F}
c=NULL
r=NULL
for(i in 1:nrow(post.weights)){
  pw.mat=matrix(as.matrix(post.weights[i,]),ncol=54,byrow=T)
  c[i]=which.max(colSums(pw.mat))
  r[i]=which.max(rowSums(pw.mat))
  }

write.table(c,"../Data/maxColsums.txt",row.names=rownames(z.stat))
write.table(r,"../Data/maxrowsums.txt",row.names=rownames(z.stat))  
})
```

Then I got a list of those that have maximum weighting at component 4 or 5:

```{r}

uk5list=which(cols==5)
```

Here's I plot eigenvector 5, and the sum of the hierarchical weight at that component is: `r round(colSums(pi.mat)[5],2)`

```{r ploteigenvec,echo=FALSE}
k=5
  
  x=covmat[[k]]/max(diag(covmat[[k]]))
colnames(x)=colnames(z.stat)
  rownames(x)=colnames(z.stat)                  
# heatmap.2(x,Rowv=FALSE,Colv=FALSE,symm=TRUE,dendrogram="none",density="none",trace="none",col=redblue(256),main=paste0("HeatMapofNormalizedUk",k),cexRow=0.5,cexCol=0.5,symkey=T,symbreaks=T)
v=svd(x)$v

rownames(v)=colnames(v)=as.matrix(abr.names)
par(mar=c(8,4.1,4.1,2.1))
barplot(v[,1]*sign(v[which.max(abs(v[,1])),1]),las=2,main=paste("Eigenvector 1 of Uk",k,round(colSums(pi.mat),2)[k]),cex.names = 0.5)

```
Here I plot all the Uk5s:

```{r echo=FALSE}
for(j in uk5list){
  newfunc(j)
}
```
