---
title: "ExampleFinals"
output: html_document
---

```{r}
library('knitr')
knitr::opts_chunk$set(cache=TRUE)
opts_chunk$set(fig.path = "/Users/sarahurbut/Dropbox/PaperEdits/Paper/Figures/") 
```


```{r exampleuk3,echo=F}
z.stat=read.table("~/Dropbox/jul3/maxz.txt")
posterior.means=read.table("~/Dropbox/Aug12/Aug13withEDposterior.means.txt")[,-1]
#posterior.means=read.table("~/Dropbox/withzero/withzeroposterior.means.txt")[,-1]
lfsr=read.table("~/Dropbox/Aug12/Aug13withEDlfsr.txt")[,-1]
#lfsr.zero=read.table("~/Dropbox/withzero/withzerolfsr.txt")[,-1]
covmat=readRDS("~/Dropbox/Aug12/covmatAug13withED.rds")
abr.names=as.character(read.table("~/gtexresults_matrixash/Data/abbreviate.names.txt")[,2])
newfunc=function(t){
  par(mfrow=c(1,2))
  name=strsplit(rownames(z.stat)[t], "[.]")[[1]][1]
  x.min=min(as.numeric(z.stat[t,]),as.numeric(posterior.means[t,]))
  x.max=max(as.numeric(z.stat[t,]),as.numeric(posterior.means[t,]))
a=barplot(as.numeric(z.stat[t,]),xlab="Tissue",#,las=2,cex.names=0.5,names=colnames(z.stat),
ylim=c(x.min,x.max))
title(main=paste0("Z Statistic"),font.main=1,col.main="blue")
mtext(paste0(name),col="purple")
b=barplot(as.numeric(posterior.means[t,]),col=col.func(t,lfsr=lfsr,posterior.means=posterior.means),xlab="Tissue",#cex.names=0.5,las=2,
          ylab="E(B|Data)/s.j",ylim=c(x.min,x.max))#,names=colnames(posterior.means))
title(main=paste0("E(B|Data)/s.j"),font.main=1,col.main="blue")
mtext(paste0(name),col="purple")
}

col.func=function(lfsr,posterior.means,j){
  R=ncol(posterior.means)
  lfsr.mat=as.matrix(lfsr)
  col.mat=NULL
  for(r in 1:R){
 if (lfsr.mat[j,r]<=0.05) {
      col.mat[r]="green"
    } else if (lfsr.mat[j,r]<0.5) {
      col.mat[r]="orange"
    } else if (lfsr.mat[j,r]>=0.50) {
      col.mat[r]="red"
    } 
  }
  return(col.mat)
}


library(gplots)
library(ggplot2)

#three.ex.1=which(rownames(z.stat)=="ENSG00000205771.2_15_44721087_T_A_b37")
three.ex.2=which(rownames(z.stat)=="ENSG00000253520.1_5_179052185_C_G_b37")
three.ex.3=which(rownames(z.stat)=="ENSG00000249898.3_8_6521432_T_C_b37")
#three.ex.4=which(rownames(z.stat)=="ENSG00000058404.15_7_44259706_G_A_b37")

    
#weightplot(genename = three.ex.1,max.weight = 3,covmat = covmat)

k=3
x=covmat[[k]]/max(diag(covmat[[k]]))
colnames(x)=colnames(z.stat)
  rownames(x)=colnames(z.stat)                  
# heatmap.2(x,Rowv=FALSE,Colv=FALSE,symm=TRUE,dendrogram="none",density="none",trace="none",col=redblue(256),main=paste0("HeatMapofNormalizedUk",k),cexRow=0.5,cexCol=0.5,symkey=T,symbreaks=T)
v=svd(x)$v

rownames(v)=colnames(v)=as.matrix(abr.names)
barplot(v[,1]*sign(v[which.max(abs(v[,1])),1]),las=2,main=paste("Eigenvector 1 of Uk",k),cex.names = 0.5)
#newfunc(three.ex.2)
newfunc(three.ex.3)
```

You can also embed plots, for example:



```{r exampleuk5,echo=FALSE}

#k=9
k=5
x=covmat[[k]]/max(diag(covmat[[k]]))
  colnames(x)=colnames(z.stat)
  rownames(x)=colnames(z.stat)                  
# heatmap.2(x,Rowv=FALSE,Colv=FALSE,symm=TRUE,dendrogram="none",density="none",trace="none",col=redblue(256),main=paste0("HeatMapofNormalizedUk",k),cexRow=0.5,cexCol=0.5,symkey=T,symbreaks=T)
five.ex=which(rownames(z.stat)=="ENSG00000120029.8_10_103924251_G_A_b37")
nine.ex.2=which(rownames(z.stat)=="ENSG00000059588.5_1_234612995_T_C_b37")
nine.ex.3=which(rownames(z.stat)=="ENSG00000009830.7_14_77776501_T_A_b37")
spec.ex=which(rownames(z.stat)=="ENSG00000131848.5_19_56741808_G_A_b37")
#barplot(diag(x),las=2,main=paste("Prior Variance of Effect Size for Uk",k),cex.names = 0.5)

#newfunc(t=nine.ex.3)

v=svd(x)$v
rownames(v)=colnames(v)=as.matrix(abr.names)
barplot(v[,1]*sign(v[which.max(abs(v[,1])),1]),las=2,main=paste("Eigenvector 1 of Uk",k),cex.names = 0.5)
newfunc(t=five.ex)
```

 Lastly, the inclusion of the eQTLBMA lite configurations (in which the SNP has a non-zero effect in only one tissue) coupled with the learned patterns of tissue specificity evident in matrices Uk : 5 − 9 serve to allow the preservation of qualitatively specific effects. Here, we show a gene-snp pair demonstrating strong posterior probability from arising from one of the eQTL-bma lite configs. Accordingly we reject the significance of the effect size estimates in all tissues but testes, a pattern consistent with the presence of tissue-specificity described below. Together, these results cement the resolution afforded by methods which can distinguish among tissues in which a QTL is called active, beyond reducing genetic effects to binary ‘on’ or ‘off’ conclusions.


```{r examplebma,echo=FALSE}
#newfunc(t=nine.ex.2)

eqtlbma.confg=t(as.matrix(c(rep(0,43),1)))
colnames(eqtlbma.confg)=as.matrix(abr.names)
barplot(eqtlbma.confg,main="SingletonConfig",las=2,cex.names=0.5)
wholebloodtwo=(which(rownames(maxz)=="ENSG00000078114.14_10_21501314_T_C_b37"))
newfunc(t = wholebloodtwo)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
