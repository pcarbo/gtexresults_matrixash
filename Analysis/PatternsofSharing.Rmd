---
title: "Modeling Patterns of Consistency"
output: html_document
---
Patterns of consistency. Let's image the most common covariance matrices.


```{r}
covmat=readRDS("../Data/covmatAug13withED.rds")
pis=readRDS("../Data/pisAug13withED.rds")$pihat
z.stat=read.table("../Data/maxz.txt")
pi.mat=matrix(pis,ncol=54,byrow=T)

barplot(t(as.matrix(colSums(pi.mat))),names=c((paste0("K",seq(1:54)))),las=2,cex.names=0.5,main="PiHat")
```

We can see that there is lots of loading on the denoised matrices.
```{r}
order(colSums(pi.mat),decreasing = T)
```

We can see that just 5 matrices appear to receive the majority of the prior weight ( `r sum(colSums(pi.mat)[1:5])`) .

```{r important.mats}
(important=order(colSums(pi.mat),decreasing = T)[1:5])
```

```{r message=FALSE, warning=FALSE, echo=FALSE}
library(gplots)
library(ggplot2)
#install.packages("fields")
library(fields)
for(k in important){
  x=covmat[[k]]
  colnames(x)=colnames(z.stat)
  rownames(x)=colnames(z.stat)
heatmap.2(x/max(diag(covmat[[k]])),Rowv=FALSE,Colv=FALSE,symm=TRUE,dendrogram="none",density="none",trace="none",col=redblue(256),main=paste0("HeatMapofNormalizedUk",k))
}
 

```

We can see that the first and most important matrix shows highly correlated genetic effects in brain and that the largest effects are correspondingly also seen in brain:
```{r order of importance}
colnames(z.stat)[order(diag(covmat[[3]]),decreasing = TRUE)][1:10]
barplot(sort(diag(covmat[[3]])/max(diag(covmat[[3]])),decreasing=TRUE),names=colnames(z.stat)[order(diag(covmat[[3]]),decreasing=TRUE)],las=2,col=c(rep("green",11),rep("orange",11),rep("magenta",11),rep("red",11)),main="PriorEffectSize",cex.names = 0.5)
```
I've colored the sizes by those tissues in each quartile.
```{r}
normdag=(diag(covmat[[3]])/max(diag(covmat[[3]])))
quantile(normdag)
name.order=colnames(z.stat)[order(diag(covmat[[3]]),decreasing=T)]
name.order[1:10]

```


